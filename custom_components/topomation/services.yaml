# Services for manual occupancy control

trigger:
  name: Trigger Occupancy
  description: Manually trigger occupancy for a location
  fields:
    entry_id:
      name: Config Entry ID
      description: Optional config entry ID when multiple Topomation entries are loaded
      required: false
      selector:
        text:
    location_id:
      name: Location ID
      description: The location to trigger occupancy for
      required: true
      example: "kitchen"
      selector:
        text:
    source_id:
      name: Source ID
      description: Identifier for the occupancy source (e.g., entity_id or manual)
      required: false
      default: "manual"
      example: "manual"
      selector:
        text:
    timeout:
      name: Timeout (seconds)
      description: How long until location becomes vacant (0 for indefinite)
      required: false
      default: 300
      example: 300
      selector:
        number:
          min: 0
          max: 86400
          unit_of_measurement: "seconds"

clear:
  name: Clear Occupancy
  description: Manually clear occupancy for a location
  fields:
    entry_id:
      name: Config Entry ID
      description: Optional config entry ID when multiple Topomation entries are loaded
      required: false
      selector:
        text:
    location_id:
      name: Location ID
      description: The location to clear occupancy for
      required: true
      example: "kitchen"
      selector:
        text:
    source_id:
      name: Source ID
      description: Identifier for the occupancy source
      required: false
      default: "manual"
      example: "manual"
      selector:
        text:
    trailing_timeout:
      name: Trailing Timeout (seconds)
      description: How long to wait before fully vacant (0 for immediate)
      required: false
      default: 0
      example: 120
      selector:
        number:
          min: 0
          max: 86400
          unit_of_measurement: "seconds"

lock:
  name: Lock Location
  description: Apply an occupancy lock policy to a location
  fields:
    entry_id:
      name: Config Entry ID
      description: Optional config entry ID when multiple Topomation entries are loaded
      required: false
      selector:
        text:
    location_id:
      name: Location ID
      description: The location to lock
      required: true
      example: "kitchen"
      selector:
        text:
    source_id:
      name: Source ID
      description: Identifier for lock source (supports multi-source locks)
      required: false
      default: "manual"
      example: "manual"
      selector:
        text:
    mode:
      name: Lock Mode
      description: Policy intent (freeze state, block occupied transitions, or block vacant transitions)
      required: false
      default: "freeze"
      selector:
        select:
          options:
            - "freeze"
            - "block_occupied"
            - "block_vacant"
    scope:
      name: Lock Scope
      description: Apply policy to only this location or the full descendant subtree
      required: false
      default: "self"
      selector:
        select:
          options:
            - "self"
            - "subtree"

unlock:
  name: Unlock Location
  description: Unlock a location to allow normal occupancy timeout
  fields:
    entry_id:
      name: Config Entry ID
      description: Optional config entry ID when multiple Topomation entries are loaded
      required: false
      selector:
        text:
    location_id:
      name: Location ID
      description: The location to unlock
      required: true
      example: "kitchen"
      selector:
        text:
    source_id:
      name: Source ID
      description: Identifier for unlock source (must match lock source)
      required: false
      default: "manual"
      example: "manual"
      selector:
        text:

unlock_all:
  name: Unlock All Sources
  description: Remove all lock sources from a location
  fields:
    entry_id:
      name: Config Entry ID
      description: Optional config entry ID when multiple Topomation entries are loaded
      required: false
      selector:
        text:
    location_id:
      name: Location ID
      description: The location to force-unlock
      required: true
      example: "kitchen"
      selector:
        text:

vacate_area:
  name: Vacate Area
  description: Vacate a location and all its descendants (cascading clear)
  fields:
    entry_id:
      name: Config Entry ID
      description: Optional config entry ID when multiple Topomation entries are loaded
      required: false
      selector:
        text:
    location_id:
      name: Location ID
      description: The location to vacate (including children)
      required: true
      example: "floor_ground_floor"
      selector:
        text:
    source_id:
      name: Source ID
      description: Identifier for this vacate action
      required: false
      default: "manual"
      example: "manual"
      selector:
        text:
    include_locked:
      name: Include Locked
      description: Also clear locked locations
      required: false
      default: false
      selector:
        boolean:
