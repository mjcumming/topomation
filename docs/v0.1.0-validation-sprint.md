# v0.1.0 Validation Sprint Plan

**Created**: 2026-02-24
**Status**: Complete
**Goal**: Validate the end-to-end integration on a live Home Assistant instance and clear the final blocker for v0.1.0 release.

---

## Background

This plan captures the outcomes of a design review session on 2026-02-24 that examined project direction, architecture scope, and the path to first release.

### Design Decisions Made (see ADR-HA-019)

- The integration stays as a **single HA integration** — no split into separate components.
- Internal structure: **Topology layer** (hierarchy + sync) + **Occupancy module** (sensors + config).
- **Actions module** is deferred to v0.2+. HA automations consuming `binary_sensor.occupancy_*` entities serve as the interim automation path.
- Naming ("Topomation") is retained for now. A rename decision is deferred until the full feature set is clear.

### The Blocking Gap

The frontend is ~95% complete. The backend has never been validated on a live HA instance. The entire occupancy signal chain:

```
motion sensor → HA state_changed → EventBridge → occupancy.signal
    → OccupancyModule → occupancy.changed → binary_sensor.occupancy_*
```

has only been tested with mocked HA. The v0.1.0 release gate is a successful live-HA manual validation pass.

---

## v0.1.0 Success Criteria

A user can:

1. Install the integration on a live HA instance
2. See their HA Areas and Floors reflected in the topology panel
3. Assign a motion sensor as an occupancy source for an Area
4. Trigger the motion sensor (physical or via Developer Tools)
5. See `binary_sensor.occupancy_<area>` turn ON within 2 seconds
6. Wait for the configured timeout; see the sensor turn OFF

If this five-step flow is reliable, v0.1.0 is ready. Everything else is polish.

---

## Sprint Phases

### Phase 1: Documentation (Complete)

- [x] ADR-HA-019: Single integration with internal module boundaries
- [x] This planning document
- [x] Update `docs/work-tracking.md` with sprint status

### Phase 2: Live HA Test Environment

**Goal**: A working HA dev instance in Docker with simulated entities, ready for validation.

**Issue**: [ISSUE-052](../project/issues/issue-052-live-ha-test-environment.md)

#### What Exists

- `tests/docker-compose.test-ha.yml` — HA container definition (port 8124), mounts integration automatically
- `make test-ha-up / test-ha-down / test-ha-logs` — container lifecycle commands
- `docs/setup-test-topology.md` — the floor/area structure to create
- `docs/live-ha-validation-checklist.md` — the manual validation procedure

#### What Needs to Be Built

- `tests/test-ha-config/configuration.yaml` — dummy entities for testing without real hardware:
  - `input_boolean` helpers → simulated motion/presence sensors (toggleable from UI)
  - `template` binary sensors wrapping those booleans (look like real sensors with `device_class: motion`)
  - `demo` platform → lights and media players
- First-time HA onboarding in the container
- Floor/Area structure from `docs/setup-test-topology.md`
- Integration installed and configured

#### Dummy Entity Design

```
Ground Floor
├── Living Room
│   ├── binary_sensor.living_room_motion (template → input_boolean.sim_living_room_motion)
│   └── light.living_room_main (demo)
├── Kitchen
│   ├── binary_sensor.kitchen_motion (template → input_boolean.sim_kitchen_motion)
│   └── light.kitchen_ceiling (demo)
└── Hallway
    └── binary_sensor.hallway_motion (template → input_boolean.sim_hallway_motion)

First Floor
├── Main Bedroom
│   ├── binary_sensor.main_bedroom_motion (template → input_boolean.sim_main_bedroom_motion)
│   └── binary_sensor.main_bedroom_presence (template → input_boolean.sim_main_bedroom_presence)
└── Guest Bedroom
    └── binary_sensor.guest_bedroom_motion (template → input_boolean.sim_guest_bedroom_motion)

Unassigned
└── Garage
    └── binary_sensor.garage_motion (template → input_boolean.sim_garage_motion)
```

Media player (for signal-key testing):

```
media_player.living_room_tv (demo)
```

#### Steps

1. Create `tests/test-ha-config/configuration.yaml` with the entities above
2. `make test-ha-up` — start the container
3. Open `http://localhost:8124`, complete onboarding
4. In HA Settings → Areas: create the floor/area structure
5. Assign each dummy entity to its area
6. In HA Settings → Integrations: add Topomation
7. Open the panel; confirm topology imports correctly

### Phase 3: Validation Execution

**Goal**: Work through `docs/live-ha-validation-checklist.md` and record results in ISSUE-051.

#### Validation Order (risk-ascending)

1. **Section 3 first — Sync and Hierarchy** (lower risk; tests the adapter/sync layer)
   - Initial import of floors/areas
   - HA → topology live sync (rename, reparent, delete)
   - Topology reorder overlay (drag-drop + floor_id writeback)
   - Lifecycle blocked (create/update/delete return `operation_not_supported`)

2. **Section 1 — Occupancy Flow** (core value proposition)
   - Motion trigger → binary sensor ON
   - Timeout → binary sensor OFF
   - Re-trigger resets timeout

3. **Section 2 — Manual Service Calls**
   - `topomation.trigger`, `.clear`, `.lock`, `.unlock`

#### For Each Failure

1. Log the failure in ISSUE-051 results table with notes
2. Open a new issue if it's a distinct bug
3. Fix and re-validate that section before moving on

---

## Definition of Done for v0.1.0

- [x] All checklist sections in `docs/live-ha-validation-checklist.md` pass
- [x] Results documented in ISSUE-051 with date, HA version, tester
- [x] No blocking errors in HA logs during validation
- [x] `CHANGELOG.md` updated with v0.1.0 release notes
- [x] `README.md` reflects current installation method

---

## Not in v0.1.0 Scope

These are explicitly deferred:

| Item | Rationale |
|------|-----------|
| Actions module | Design question open: what does it provide beyond native HA automations? |
| Integration rename | Deferred until full feature set is stable |
| HACS default repo listing | Requires v1.0.0 stability |
| Parent/child occupancy rollup UI | Works in backend; UI visualization deferred |
| Visual regression tests (Playwright) | Frontend is stable; full regression suite is v0.2+ |

---

**Owner**: Mike
**Next Action**: Prepare v0.1.0 release cut and tag from current validated state.
