# Phase 3: What's New? ğŸ‰

**Quick Reference Guide for New Features**

---

## TL;DR

You can now:

- **Drag locations** to move them in the hierarchy
- **Double-click to rename** locations inline
- **See occupancy state** at a glance (colored dots)
- **Use keyboard shortcuts** like Ctrl+S to save
- **Create/edit locations** with proper dialogs

---

## 1. Drag & Drop ğŸ–±ï¸

### How It Works

1. Hover over any location in the tree
2. You'll see a `â‹®â‹®` drag handle appear
3. Click and drag the handle to move the location
4. Drop it on a new parent location

### Rules

- Can't drag a floor into a room (hierarchy is enforced)
- Invalid drops will flash red
- Changes save automatically when you drop

### Visual Feedback

- Ghost element follows your cursor
- Original location fades out during drag
- Drop target highlights when valid

**Example**: Drag "Kitchen" from "Ground Floor" to "Basement"

---

## 2. Inline Rename âœï¸

### How It Works

1. **Double-click** the name of any location in the tree
2. An input field appears with the current name selected
3. Type the new name
4. Press **Enter** to save or **Escape** to cancel

### What Happens

- Name saves immediately to backend
- Toast notification confirms "Renamed to 'New Name'"
- Inspector panel updates automatically
- If save fails, old name is restored

**Example**: Double-click "Living Room" â†’ type "Main Living Room" â†’ Enter

---

## 3. State Indicators ğŸ”´ğŸŸ¢

### What You See

Small colored dots next to location names show occupancy state:

| Color     | Meaning      | Example                      |
| --------- | ------------ | ---------------------------- |
| ğŸŸ¢ Green  | **Occupied** | Someone is in the room       |
| âšª Gray   | **Vacant**   | No one detected              |
| ğŸŸ¡ Yellow | **Locked**   | Occupancy detection disabled |

### How It Works

- Dots appear next to locations with occupancy configured
- Updates in real-time (no refresh needed)
- Hover over dot to see tooltip with state name

**Example**: When you walk into "Kitchen", the dot turns green instantly

---

## 4. Keyboard Shortcuts âŒ¨ï¸

### Available Shortcuts

| Shortcut       | Action              | Notes                                   |
| -------------- | ------------------- | --------------------------------------- |
| `Ctrl+S`       | **Save changes**    | Works even without clicking Save button |
| `Escape`       | **Discard changes** | Asks for confirmation first             |
| `?`            | **Show help**       | Lists all available shortcuts           |
| `Ctrl+Z`       | _Undo_              | Coming soon (placeholder)               |
| `Ctrl+Shift+Z` | _Redo_              | Coming soon (placeholder)               |

### Tips

- Shortcuts work anywhere in the panel
- Won't interfere with text inputs (automatically disabled)
- Mac users: `Cmd` instead of `Ctrl`

**Example**: Make some changes â†’ press `Ctrl+S` â†’ done!

---

## 5. Dialog Improvements ğŸ“

### Create Location

- Click "New Location" button in tree
- Fill out the form:
  - Name (required)
  - Type (building, floor, room, etc.)
  - Parent location
  - Linked HA Area (optional)
- Click "Save" â†’ location appears in tree

### Edit Location

- Click the edit icon in the inspector
- Same form, but pre-filled with existing data
- Save to update

### Add Device

- Click "Add Device" in the occupancy section
- Pick an entity from the entity picker
- Configure occupancy settings (mode, events, etc.)
- Save â†’ device appears in occupancy sources list

---

## Visual Guide

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Home Topology                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Tree Panel               â”‚ Inspector    â”‚
â”‚                         â”‚              â”‚
â”‚  â‹®â‹® ğŸ  House          â”‚  Kitchen     â”‚
â”‚   â”œâ”€ â‹®â‹® ğŸŸ¢ Kitchen    â”‚  Type: Room  â”‚
â”‚   â”‚  â””â”€ â‹®â‹® Pantry     â”‚              â”‚
â”‚   â””â”€ â‹®â‹® âšª Bedroom    â”‚  Occupancy:  â”‚
â”‚                         â”‚  [Add Device]â”‚
â”‚  [New Location]         â”‚              â”‚
â”‚  [Seed Demo Data]       â”‚              â”‚
â”‚                         â”‚              â”‚
â”‚  Press ? for shortcuts  â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Annotations**:

- `â‹®â‹®` = Drag handle (hover to see)
- `ğŸŸ¢` = Occupied (green dot)
- `âšª` = Vacant (gray dot)
- Double-click name to rename
- Drag `â‹®â‹®` to move

---

## Common Workflows

### Reorganize Your Home

1. Drag "Guest Room" from "First Floor" to "Second Floor"
2. Watch it move in real-time
3. Done! No save button needed

### Quickly Rename Multiple Locations

1. Double-click "Bed 1" â†’ type "Master Bedroom" â†’ Enter
2. Double-click "Bed 2" â†’ type "Guest Bedroom" â†’ Enter
3. Double-click "Bed 3" â†’ type "Kids Room" â†’ Enter
4. All saved automatically

### Monitor Occupancy at a Glance

1. Look at tree panel
2. Green dots = someone's home
3. Gray dots = empty rooms
4. No clicking needed, updates live

### Save Your Work Fast

1. Make several changes (rename, move, etc.)
2. Press `Ctrl+S`
3. Toast shows "Changes saved"
4. Continue working

---

## Developer Tools

### Storybook (Visual Testing)

```bash
cd custom_components/home_topology/frontend
npm run storybook
```

Opens `http://localhost:6006` with:

- Interactive component previews
- Test different states (empty, selected, etc.)
- No need for full HA instance

### Unit Tests

```bash
npm test
```

Runs tests for:

- Drag & drop logic
- Inline rename
- State indicators
- Event dispatching

---

## Troubleshooting

### Drag Not Working?

- Make sure you're dragging the `â‹®â‹®` handle, not the location name
- Check browser console for errors
- Try refreshing the page

### Rename Not Saving?

- Check your internet connection
- Look for error toast notification
- Check browser console for WebSocket errors

### Dots Not Updating?

- Ensure occupancy module is configured for that location
- Check that entities are reporting state changes
- Verify WebSocket connection is active

### Keyboard Shortcuts Not Working?

- Make sure you're not typing in an input field
- Check that focus is on the panel (click anywhere in the panel first)
- Try pressing `?` to see if help dialog appears

---

## What's Next?

### Coming in Phase 4 (tentative)

- âœ… Undo/Redo functionality
- ğŸ“‹ Multi-select locations
- ğŸ¨ Custom location icons
- ğŸ” Search/filter tree
- ğŸ¯ Right-click context menu

### Want to Help?

- Report bugs in GitHub Issues
- Suggest features in Discussions
- Test the beta and provide feedback

---

## Questions?

- **Documentation**: See `docs/frontend-patterns.md` for technical details
- **Architecture**: See `docs/ui-design.md` for design rationale
- **Testing**: See `docs/frontend-testing-patterns.md` for test examples
- **Complete Summary**: See `PHASE-3-COMPLETION-SUMMARY.md` for exhaustive details

---

**Have fun managing your topology! ğŸ âœ¨**
