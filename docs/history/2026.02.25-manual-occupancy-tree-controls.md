# Manual occupancy tree controls

Date: 2026-02-25

## Summary

Added direct occupied/unoccupied controls to location tree rows and aligned the
manual "vacant" behavior with deterministic vacate semantics.

## What changed

1. Added row-level occupancy control icon in `ht-location-tree`.
2. Wired panel handler for `location-occupancy-toggle`.
3. Enforced lock invariant in UI path (locked locations reject manual occupancy changes).
4. Changed manual "set unoccupied" behavior to call `topomation.vacate_area`
   instead of source-level `clear`.
5. Added debounced autosave scheduling on `occupancy.changed` so runtime occupancy
   mutations persist.

## Documentation updates

1. `docs/architecture.md`
   - Service-wrapper behavior for manual tree controls
   - Workspace behavior includes occupancy quick controls
   - Persistence save triggers include `occupancy.changed`
2. `docs/installation.md`
   - Added "Manual occupancy controls in the tree" section
3. `docs/live-ha-validation-checklist.md`
   - Added `vacate_area` under service checks
   - Added UI checklist for tree-level occupied/unoccupied controls
4. `docs/adr-log.md`
   - Added ADR-HA-028 (manual tree controls + lock-safe vacate semantics)

## ADR

- ADR-HA-028: Manual Occupancy Tree Controls with Lock-Safe Vacate Semantics

